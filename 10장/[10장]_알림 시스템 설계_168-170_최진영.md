# 알림 시스템 설계
> 알림 유형별 지원 방안 IOS 푸시 알림에 이어서..

## 알림 유형별 지원 방안#2 안드로이드 푸시 알림
안드로이드 푸시 알림 또한, IOS 푸시 알림과 비슷한 절차로 전송됩니다.
![image_10-3.png](image%2Fimage_10-3.png)
마찬가지로 `알림제공자(provider)`가 알림 요청을 만들어서 `FCM(Firebase Cloud Messaging)`으로 보냅니다.

알림 요청을 받은 `FCM`은 푸시 알림을 `안드로이드 단말`로 보냅니다.

> 질문: APNS 대신 FCM을 사용한다는데, FCM은 apple 디바이스를 지원 안하는 걸까요?
> 
> FCM은 Apple 디바이스 또한 지원합니다. 단, FCM이 APNs와 중간에서 연동되어야 한다고 합니다.
> 
> ![fcm_apple.png](image%2Ffcm_apple.png)
> 
> *Android transport layer(ATL): Google Play 서비스를 사용하는 Android 기기용 Android 전송 레이어

## 알림 유형별 지원 방안#3 SMS 메시지
SMS 메시지를 보낼 때는 보통 트윌리오(Twilio), 넥스모(Nexmo) 같은 제3 사업자의 서비스를 많이 이용합니다. 
이런 서비스는 대부분 상용 서비스라서 이용 요금을 내야합니다.
(위 서비스들은 '클라우드 커뮤니케이션 플랫폼' 입니다. 두 플랫폼 모두 SMS, 음성 및 비디오 커뮤니케이션을 위한 API를 제공합니다. )

![image_10-4.png](image%2Fimage_10-4.png)

> *Twilio와 Nexmo의 차이
> - 가격 모델
> - 글로벌 적용 범위
> - 인증 및 보안
> - 파트너쉽
> - 개발자 경험
> - 추가 플랫폼 서비스(핵심 메시징 외 서비스)
> 
> 참고 : https://stackshare.io/stackups/nexmo-vs-twilio

## 알림 유형별 지원 방안#4 이메일
대부분의 회사는 고유 이메일 서버를 구축할 역량은 갖추고 있습니다. 그럼에도 많은 회사가 `상용 이메일 서비스`를 이용하는데요.
그 중 유명한 서비스로 `샌드그리드(Sendgrid)`, `메일침프(Mailchimp)`가 있습니다. 이 둘은 전송 성공률도 높고, 데이터 분석 서비스도 제공합니다.

> *Sendgrid와 Mailchimp의 차이
>
> Sendgrid: 개발자 중심의 이메일 API 서비스, 대용량 트랜잭션 이메일과 높은 전달율에 특화
> 
> Mailchimp: 사용자 친화적인 이메일 마켓팅 플랫폼. 주로 GUI 기반으로 뉴스레터, 프로모션, 마케팅 자동화에 초점
> 
> 메일침프는 비개발자 중심으로 사용하기 쉽다는 점, 샌드그리드는 개발자 중심으로 러닝 커브가 있지만, 전달율이 탁월하다는 점이 차이점인 것 같습니다.

아래 그림은 지금까지 살펴본 알림 유형 전부를 한 시스템으로 묶은 결과입니다.

![image_10-6.png](image%2Fimage_10-6.png)

## 연락처 정보 수집 절차
알림을 보내려면 `모바일 단말 토큰(모바일), 전화번호(SMS), 이메일 주소(이메일)` 등의 정보가 필요합니다.
아래 그림과 같이 사용자가 우리 `앱을 설치`하거나 `처음으로 계정을 등록`하면 API 서버는 해당 사용자의 정보를 수집하여 데이터베이스에 저장합니다.

![image_10-7.png](image%2Fimage_10-7.png)

아래 그림은 데이터베이스에 저장할 연락처 정보 테이블 구조입니다.

![image_10-8.png](image%2Fimage_10-8.png)

개략적인 설계안으로써, `모바일 단말 토큰`은 `device` 테이블에, 나머지 이메일 주소나 전화번호는 `user` 테이블에 저장합니다.

이는 한 사용자가 여러 단말기를 가질 수 있고, 모든 단말기에 알림이 전송되어야 한다는 점을 고려한 설계입니다.


