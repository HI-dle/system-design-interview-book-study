# URL 단축기 상세 설계, URL 리디렉션 설계

---

## URL 단축기 상세 설계

- UR 단축기는 시스템의 핵심 컴포넌트이므로, 그 처리 흐름이 논리적으로는 단순해야 하고 기능적으로는 언제나 동작하는 상태로 유지되어야 한다. 본 예제에서는 62진법 변환 기법을 사용해 설계할 것이다.

![image_8_7.png](image%2Fimage_8_7.png)

1. 입력으로 긴 URL을 받는다.

2. DB에 해당 URL이 있는지 검사한다.

3. DB에 있다면 해당 URL에 대한 단축 URL을 만든 적이 있는 것으로 따라서 db에서 해당 단축 URL을 가져와 클라이언트에게 반환한다.

4. DB에 없는 경우에는 해당 URL을 새로 접수된 것이므로 유일한 ID를 생성하고 ID는 DB에서 기본키로 사용된다.

5. 62진법 변환을 적용해 ID를 단축 URL로 만든다.

6. ID, 단축 URL, 원래 URL로 새 DB 레코드를 만든 후 단축 URL을 클라이언트에 전달한다.

- 입력된 URL이 https://en.wikipedia.org/wikilsystems_design이라고 하자.
- 이 URL에 대해 ID 생성기가 반환한 ID는 2009215674938이다.
- 이 ID를 62진수로 변환하면 zn9edcu를 얻는다.
- 새 데이터베이스 레코드를 만든다.

![image_table_8_4.png](image%2Fimage_table_8_4.png)


 - ID 생성기는 단축 URL을 만들 때 사용할 ID를 만드는 것이고 이 ID는 전역적 유일성(globally unique)이 보장되는 것이어야 한다. 고도로 분산된 환경에서 이 생성기를 만드는 것은 무척 어려운 일이며, ID 생성기에 대한 부분은 이전 장에서 확인했다.



## URL 리디렉션 상세 설계

![image_8_8.png](image%2Fimage_8_8.png)

 - 위 그림은 URL 리디렉션 메커니즘의 상세한 설계를 그리고 있다. 쓰기보다 읽기를 더 자주 하는 시스템이라 단축 URL과 원래 URL을 쌍으로 이루어 저장해 성능을 높였다.

 - 위 그림의 로드 밸런서를 확인해 보자.



1. 사용자가 단축 URL을 클릭한다.
2. 로드밸런서가 해당 클릭으로 발생한 요청을 웹서버에 전달한다.
3. 단축 URL이 이미 캐시에 있는 경우에는 원래 URL을 바로 꺼내서 클라이언트에게 전달한다.
4. 캐시에 해당 단축 URL이 없는 경우에는 데이터베이스에서 꺼낸다. 데이터베이스에 없다면 아마 사용자가 잘못된 단축 URL을 입력한 경 우일 것이다.

5. 데이터베이스에서 꺼낸 URL을 캐시에 넣은 후 사용자에게 반환한다.



 - URL 단축기의 API, 데이터 모델, 해시 함수, URL 단축 및 리디렉션 절차를 설계해 보았고 설계 이후에 면접관이 더 질문할 수 있는 것들을 알아보자.

   - 처리율 제한 장치 : 수 많은 URL 단축 요청이 발생할 경우 시스템이 무력화될 수 있는 점에 대해 잠재적 보안 결함을 갖고 있다.

   - 처리율 제한 장치를 두면 IP 주소를 비롯한 필터링 규칙들을 이용해 요청을 걸러낼 수 있을 것이다.

   - 웹 서버의 규모 확장 : 설계에 포함된 웹 계층은 무상태를 유지하므로 웹 서버를 자유로이 증설 및 삭제할 수 있다.

   - 데이터베이스의 규모 확장 : 데이터베이스를 다중화하거나 샤딩해 규모 확장성을 달성할 수 있다.

   - 데이터 분석 솔루션 : 성공적인 비즈니스를 위해서는 데이터가 중요하고 URL 단축기에 데이터 분석 솔루션을 통합하면 어떤 링크를 얼마나 많은 사용자가 클릭했는지, 언제 주로 클릭했는지 등 중요한 정보를 알아낼 수 있을 것이다.

   - 가용성, 데이터 일관성, 안정성 : 대규모 시스템이 성공적으로 운영되기 위해서는 반드시 갖추어야 할 속성이다.



- 이외로 데이터 분석 솔루션으로 기업에서 많이 사용되는 예 하나를 소개하고 마치도록 하겠다.



### Google Analytics(GA)

 - 구글에서 제공하는 웹 로그 분석 툴이다.

 - 방문자 유입 소스나 사이트 내 행동과 같은 정보를 분석, 저장하는 툴이다.



 - GA를 사용하는 이유로는 방문자의 유입 출처 확인, 사용자 행동 파악, 양질의 트래픽을 찾기 위함, 사이트와 콘텐츠에 대한 평가, 구글 광고의 최적화, 목표 데이터, 잠재고객 목록이 있다.



 - 웹 로그 분석이란 사이트 방문자에 대해 분석하는 작업을 말하고 웹로그 프로그램은 방문자의 유입경로나 위치, 검색어, OS/브라우저 등 사용자의 특성을 정의할 수 있는 모든 정보들을 기록하고 보여준다.

 - GA는 마케팅을 위한 정보 분석 및 관리에 사용 되지만 위에서 말한 데이터 분석 솔루션에 대해 데이터를 수집하고 분석하게 되는데 이를 자동화하고 도와주는 도구 중 하나로 소개해 보았다.