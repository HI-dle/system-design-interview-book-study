# 뉴스 피드 시스템 설계

---

- 상세 설계를 이어 받아 상세 설계 흐름부터 확인하자.

![image_11-7.png](image%2Fimage_11-7.png)


-이미지나 비디오와 같은 미디어 콘텐츠는 CDN에 저장하고 빨리 읽을 수 있게 했다. 이제 클라이언트가 뉴스 피드를 어떻게 읽는지 단계별로 알아보자.

1. 사용자가 뉴스 피드를 읽으려는 요청을 보낸다. 요청은 /v1/me/feed로 전송될 것이다.

2. 로드 밸런서가 요청을 웹 서버 가운데 하나로 보낸다.

3. 웹 서버는 피드를 가져오기 위해 뉴스 피드 서비스를 호출한다.

4. 뉴스 피드 서비스는 뉴스 피드 캐시에 포스팅 ID 목록을 가져온다.

5. 뉴스 피드에 표시할 사용자 이름, 사용자 사진, 포스팅 콘텐츠, 이미지 등을 사용자 캐시와 포스팅 캐시에서 가져와 완전한 뉴스 피드를 만든다.

6. 생성된 뉴스 피드를 JSON 형태로 클라이언트에게 보낸다. 클라이언트는 해당 피드를 렌더링 한다.



## 캐시 구조

 - 캐시는 뉴스 피드 시스템의 핵심 컴포넌트다. 본 설계에서는 다음과 같이 캐시를 5 계층으로 나눈다.
   뉴스 피드 : 뉴스 피드의 ID를 보관한다.

![image_11-8.png](image%2Fimage_11-8.png)

 - 콘텐츠 : 포스팅 데이터를 보관한다. 인기 콘텐츠는 따로 보관한다.

 - 소셜 그래프 : 사용자 간 관계 정보를 보관한다.

 - 행동 : 포스팅에 대한 사용자 행위에 관한 정보를 보관한다. 포스팅에 대한 좋아요나 답글 등등이 이에 해당한다.

 - 횟수 : 좋아요 횟수, 응답 수, 팔로어 수, 팔로잉 수 등의 정보를 보관한다.



 - 마무리로 이번 설계안은 뉴스 피드 발행과 생성의 두 부분으로 구성되어 있다. 다른 설계들과 마찬가지로 정답은 없다. 각 회사별 독특한 제약이나 요구조건이 있기 때문인데 시스템을 설계할 땐 이 점을 고려해야 한다. 설계를 진행하고 기술을 선택할 때 그 배경에서 어떤 타협적 결정들이 있는지 잘 이해하고 설명할 수 있어야 한다. 설계를 마친 후 시간이 남는다면 규모 확장성 이슈를 논의하는 것도 좋다. 이때 다룰만한 문제들이 뭐가 있는지 확인해 보자.


### 데이터베이스 규모 확장
 - 수직적 확장과 수평적 확장, SQL과 NoSQL, 주-부 다중화, 복제본에 대한 읽기 연산, 일관성 모델, 데이터베이스 샤딩

### 이외 고려사항
 - 데이터베이스에 관해선 이 정도고 이외 더 논의하면 좋을 주제로는 웹 계층을 무상태로 운영하기, 가능한 한 많은 데이터 캐시할 방법, 여러 데이터 센터를 지원할 방법, 메시지 큐를 사용해 컴포넌트 사이의 결합도 낮추기, 핵심 메트릭에 대한 모니터링으로 트래픽이 몰리는 시간대의 QPS, 사용자가 뉴스 피드를 새로고침할 때 지연시간 등이 해당된다.