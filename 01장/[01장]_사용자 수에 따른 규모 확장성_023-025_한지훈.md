# 로그, 메트릭 그리고 자동화

---

## 로그(log)

로그는 컴퓨터 시스템과 네트워크 사이 발생하는 활동과 사건에 대한 기록으로 추적에 있어 중요한 역할을 합니다.

시스템의 작동 상태, 사용자 행동, 오류, 경고, 보안 사건 등을 주로 기록하고 분석하는 데 사용된다.

## 로그의 종류



### 1. 이벤트 로그(Event Log)

운영 체제, 응용 프로그램에 발생하는 이벤트와 관련된 정보를 기록한다. 이벤트 로그는 시스템 시작이나 종료, 로그인 시도, 프로그램 실행, 시스템 오류 등을 기록해 문제 해결에 사용된다.



### 2. 액세스 로그(Access Log)

서버나 네트워크 장비에서 발생한느 사용자의 접속 정보를 기록한다. IP 주소, 요청 자원, 접속 시간 등을 포함해 웹 트래픽 모니터링, 보안 분석, 사용자 행동 추적 등에 사용된다.



### 3. 보안 로그(Security Log)

시스템 보안과 관련된 사건을 기록한다. 해킹 시도, 비안가 접근, 보안 위협 등의 정보를 포함해 보안 사고에 대해 대응과 예방에 중요한 역할을 한다.



### 4. 설정 로그(Configuration Log)

시스템 구성 변경 사항을 기록한다. 소프트웨어 업데이트, 설정 변경, 구성 요소 간의 연결 등을 추적하여 시스템 변경의 효과를 모니터링하고 분석한다.

## 로그의 관리 5단계

### 1. 수집

시스템에 로그 수집기를 설치하여 HTTPS 등의 방식으로 로그 관리 시스템에 전당



### 2.중앙 처리와 인덱싱

로그를 중앙 집중화해 누락된 데이터가 없도록 한다. 필요시 인덱스 값을 추가해 로그의 그룹을 지어주기도 한다.



### 3.검색과 분석

인덱싱이 완료된 데이터에 대한 검색과 분석을 진행해 데이터의 공통 패턴이 존재한다면 찾아낸다.



### 4. 모니터링과 경고

슬랙, Hipchat등의 협업 도구로 알림 시스템과 로그 관리 시스템을 연동한다.



### 5. 리포트와 대시보드

전반적인 시스템 상태 확보를 위해 비주얼 한 리포트와 대시보드를 생성해 공유한다.

## 로그 관리 솔루션이 필요한 이유

대용량 로그의 크기는 대형이며 지속적으로 증가한다

컴플라이언스에 대해 로그는 안전하게 저장되어야 한다.

로그 파일 하나에 대해 인사이트를 알 수 없다. 집약되고 분석한 로그만 의미가 있다.



## 중앙 집중형 로그 관리 시스템의 장점

로그는 여기저기 흩어져 있기 때문에 IT 서비스의 사용률이 증가한다면 비례해 증가한다. 엄청나게 많은 로그를 분리해 관리한다면 분석하기 어렵기 때문에 중앙으로 집중해 시스템을 연관 지어 해결할 수 있다.

최근에는 빅데이터와 예측 시스템으로 머신러닝 기법을 통해 패턴을 분석해 어떤 이벤트에 대해 예측도 가능하다.

---

## 매트릭(metric)

하드웨어나 소프트웨어에 대한 성능 측정을 위한 측정 수치 값이다.

타임 스탬프와 숫자 값을 포함하는 이벤트이다. 이 메트릭은 모든 메트릭의 행이 타임스탬프로 정렬된 메트릭 파일에 순차적으로 추가된다.

메트릭은 특정 주기를 통해 보내게 되고 로그와 같이 모니터링에서 사용된다.



## 주로 사용되는 메트릭

### 1. 호스트 단위 메트릭

CPU, 메모리, 디스크 I/O에 관한 메트릭이 여기 해당한다.



### 2. 종합 메트릭

데이터베이스 계층의 성능, 캐시 계층의 성능 같은 것이다.



### 3.핵심 비즈니스 메트릭

일별 능동 사용자, 수익, 재방문 같은 비즈니스 메트릭이다.

보통 메트릭의 모니터링 구성은 프로메테우스, 엘라스틱서치를 사용하는 메트릭 비트와 그라파나를 통해 구성하게 된다.


## 자동화

여기서 자동화는 설계에서의 자동화이다. 자동화는 단순히 자동으로 동작한다는 개념을 넘어 설계 의도나 구조적인 반복을 줄이고 일관성과 효율성을 확보하기 위한 수단으로 사용된다. 생산성을 높이기 위해서는 자동화 도구를 활용해야 한다 지속적 통합을 도와주는 도구를 활용해서 개발자가 만드는 코드가 어떤 검증 절차를 자동으로 거치도록 할 수 있어서 문제를 쉽게 감지할 수 있다. 이때 빌드, 테스트, 배포 등의 절차를 자동화할 수 있어서 개발 생산성을 크게 향상할 수 있다.

### 각 영역별 자동화 

| 자동화 항목             | 설명                                              | 도구 예시                                                |
|------------------------|---------------------------------------------------|-----------------------------------------------------------|
| 코드 생성 자동화        | 반복되는 도메인 객체, DTO, 리포지토리 등 생성     | Lombok, JPA Entity Generator, Swagger Codegen             |
| 배포 자동화            | 시스템 빌드 및 배포 과정 자동화                   | CI/CD (GitHub Actions, Jenkins)                           |
| 테스트 자동화          | 반복되는 테스트 실행 자동화                       | JUnit, 테스트 스크립트, 테스트 시나리오 자동 실행         |
| 문서 자동화            | API나 시스템 아키텍처 문서를 자동 생성            | Swagger, Spring REST Docs                                 |
| 인프라 자동화          | 서버/네트워크 구성 자동화                         | Terraform, Ansible, AWS CloudFormation                    |
| 모니터링/알림 자동화   | 시스템 상태 감시 후 자동으로 알림 발송            | Prometheus + Alertmanager, Grafana 알림 설정              |


### 자동화의 이점

반복 제거, 일관성 유지, 생산성 향상, 테스트와 검증 강화, 변화 대응력 향상



## 로그, 메트릭을 통한 모니터링 자동화를 메시지 큐를 사용 했을 때 구성 설계 방안
![img.png](images/025/p.25_image.png)

---
## 질문

p. 23 맨 아래
로그를 단일 서비스로 모아주는 도구는 ELK가 맞나요? 아니라면 무엇이 있을까요?

 ->  로그를 단일 서비스로 모아 분석하고 시각화할 수 있도록 해주는 대표적인 도구가 ELK Stack이다.

 Elasticsearch: 로그 데이터를 저장하고 검색하는 분산 검색 엔진

 Logstash: 다양한 로그 소스를 수집, 필터링, 가공해서 Elasticsearch로 전송하는 데이터 파이프라인 도구

 Kibana: Elasticsearch에 저장된 로그를 시각화하는 웹 UI 도구


p. 25 그림 1-19
그림에서 웹 서버와 작업 서버는 무엇을 의미 하는지? 우리 서비스로 예시를 든다면 예약 서버가 결제 서버를 찌르는 것과 같은 의미가 맞을까요?

 -> 작업 서버는 주로 비동기 작업을 처리하는 백엔드 서버를 의미한다.
 
````
[사용자] → [웹서버] → [메시지 큐] → [작업 서버(Worker)]
                           ↑                ↓
                        비동기 요청       백그라운드 처리
````

위와 같은 흐름으로 진행이 될 수 있고 요청을 받는 서버가 웹서버이고 작업 서버는 실시간 응답이 필요 없는 작업을 비동기로 처리하는 서버이다.
아래와 같은 작업을 수행할 때 보통 작업 서버에서 수행한다.
- 이메일/SMS 발송
- 이미지/동영상 변환
- 대용량 파일 처리
- 외부 API 호출
- 백그라운드 DB 작업