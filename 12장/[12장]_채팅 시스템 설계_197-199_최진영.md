# 채팅 시스템 설계
이번 장에서는 채팅 시스템을 설계해 볼 것입니다.

현재 시장에서 가장 널리 쓰이고 있는 채팅 시스템을 아래 그림에서 몇 가지 나열했습니다.

![image_12-1.png](image%2Fimage_12-1.png)

채팅 앱이라고 했을 때, 사람들이 떠올리는 것은 다 제각각일 것입니다. 그러니 요구사항을 분명히 해 두는 것이 아주 중요합니다.

예를 들어, 면접관이 생각하고 있는게 `일대일 채팅 앱`일 때, `그룹 채팅 앱`을 설계하면 곤란할 것입니다.

## 1단계: 문제 이해 및 설계 범위 확정
어떤 채팅 앱을 설계하려는지 확실히 해 두는 것이 면접에서 가장 중요합니다.

현재 시장에 나와 있는 앱들을 보면 `페이스북 메신저` 처럼 1대1 채팅에 집중하는 앱들이 있는가 하면, 
`슬랙(Slack)`같은 그룹 채팅에 중점을 둔 업무용 앱이나,
게임 채팅에 쓰이는 `디스코드(Discord)` 같이 대규모 그룹의 소통과 응답지연이 낮은 음성 채팅에 집중하는 앱도 있습니다.

따라서 초반에 던져야 하는 질문들은 면접관이 원하는 앱이 정확히 무엇인지를 알아내기 위한 것이어야 합니다.

적어도 해당 채팅 앱이 1대1 채팅 앱인지, 그룹 채팅 앱인지 정도는 알아내야 합니다.

아래는 면접관에게 던져볼 수 있는 질문의 사례입니다.

- 어떤 앱을 설계해야하나요? 1대1 채팅 앱인가요? 아니면 그룹 채팅 앱인가요?
- 모바일 앱인가요? 아니면 웹 앱인가요?
- 처리해야하는 트래픽 규모는 어느 정도인가요?
- 그룹 채팅의 경우에 인원 제한이 있나요?
- 중요 기능으로는 어떤 것이 있을까요? 첨부파일도 지원할 수 있어야 할까요?
- 메시지 길이에 제한이 있나요?
- 종단 간 암호화를 지원해야 할까요?
- 채팅 이력은 얼마나 보관해야 할까요?

이번 12장에서는 페이스북 메신저와 유사한 채팅 앱을 설계해 볼 것입니다.
이 앱은 다음과 같은 기능을 갖습니다.
- 응답지연이 낮은 일대일 채팅 기능
- 최대 100명까지 참여할 수 있는 그룹 채팅 기능
- 사용자의 접속상태 표시 기능
- 다양한 단말 지원, 하나의 계정으로 여러 단말에 동시 접속 지원
- 푸시 알림

그리고 위의 질의응답 사례에 나온 대로, 5천만 DAU를 처리할 수 있도록 할 것입니다.

### 종단간 암호화란?
메시지를 처음부터 끝까지 평문으로 저장하지 않고 암호화하는 안전한 통신 방법입니다.

클라이언트에서 메시지를 전송하는 단계부터 최종적으로 수신자에 전달되는 단계까지 메시지를 암호화하기 때문에 `End to End Encryption(E2EE)`으로 불리기도 합니다.

종단간 암호화 방법은 메시지를 복호화할 수 있는 키를 서버에 저장하지 않고, 수신자 장치에서 저장합니다. 그래서 수신자에게 발송되는 동안 데이터가 제 3자에 의해 읽히거나 조작될 수 없습니다.
(데이터를 전달하는 서버조차 데이터를 복호화할 수 없습니다.)

이는 카카오톡 `비밀 채팅`, `Zoom`등 메시지를 전달하는 서비스에서 자주 사용하는 통신 방법이라고 합니다.
매우 안전하지만 메시지를 복구하기 어렵고 불법 활동에 사용될 위험도 있습니다.(운영자조차 메시지를 볼 수 없기 때문에, 범죄 대화, 테러 계획등을 하더라도 감지/제어가 어렵기 때문)

```markdown
*쥐피티에게 물어본 암호화 과정
1. 수신자는 본인의 키쌍을 갖고 있다.
  - 공개키 -> 모두에게 공개
  - 개인키 -> 수신자 기기 내부에만 존재
2. 송신자는 수신자의 공개키를 받아서, 메시지를 암호화한다.
3. 암호화된 메시지는 네트워크를 거쳐 전송된다.
4. 수신자는 자신의 개인키로만 복호화 가능
```

