# 유튜브 설계

---


- 이번 장은 유튜브 시스템 설계이다. 이 문제는 넷플릭스나 훌루 같은 비디오 플랫폼을 설계하는 문제에도 적용이 가능하다.

 - 우선 유튜브 시스템 통계 자료를 확인하자. 이는 2020년에 조사된 결과이다.
   - 월간 능동 사용자 수 : 20억
   - 매일 재생되는 비디오 수 : 50억
   - 미국 성인 가운데 73%가 유튜브 사용
   - 5천만 명의 창작자
   - 유튜브 광고 수입은 2019년 기준 150억 달러 이는 2018년 기준 36% 상승한 수치이다.
   - 모바일 인터넷 트래픽 가운데 37%를 유튜브가 점유했다.
   - 80개 언어로 사용 가능
 - 세계적 서비스로 가장 큰 서비스 중 하나인 것을 확인할 수 있다.

## 문제 이해 및 설계 범위 확정

 - 유튜브는 단순히 비디오를 보는 것 말고 많은 일을 할 수 있다.
 - 댓글을 남길 수 있고 비디오응 공유하거나 좋아요 버튼을 누를 수 있고, 자기 재생목록에 저장을 할 수도 있고, 채널을 골라 구독할 수 있다.
 - 이 모두를 45분에서 60분 가량 진행되는 면접 시간에 모두 설계하는 것은 불가능하다. 그러니 적절한 질문을 통해 설계 범위를 좁혀야 한다.

 - 면접 시나리오
   - 지원자 : 어떤 기능이 가장 중요한가요?
   - 면접관 : 비디오를 올리는 기능과 시청하는 기능입니다.
   - 지원자 : 어떤 클라이언트를 지원해야 하나요?
   - 면접관 : 모바일 앱, 웹 브라우저, 스마트 TV 입니다.
   - 지원자 : 일간 능동 사용자 수는 얼마입니까?
   - 면접관 : 500만 입니다.
   - 지원자 : 사용자가 이 제품에 평균적으로 소비하는 시간은 얼마입니까?
   - 면접관 : 30분 입니다.
   - 지원자 : 다국어 지원이 필요한가요?
   - 면접관 : 네 어떤 언어로도 이용 가능해야 합니다.
   - 지원자 : 어떤 비디오 해상도를 지원해야 할까요?
   - 면접관 : 현존하는 비디오 종류와 해상도를 대부분 지원해야 합니다.
   - 지원자 : 암호화가 필요할까요?
   - 면접관 : 네.
   - 지원자 : 비디오 파일 크기 제한도 있나요?
   - 면접관 : 작은 비디오, 혹은 중간 크기 비디오에 초점을 맞추도록 합시다. 비디오 크기는 최대 1GB로 제한합니다.
   - 지원자 : 아마존이나 구글, 마이크로소프트가 제공하는 클라우드 서비스를 활용해도 될까요?
   - 면접관 : 좋은 질문입니다. 모든걸 바닥부터 쌓아 올리는 것은 대부분 회사에게는 비현실적인 일이죠. 활용할 수 있다면 활용하는 것이 바람직할 것입니다.
 - 위 내용을 기준으로 설계 사항을 요약하면 아래와 같다.
   - 빠른 비디오 업로드
   - 원활한 비디오 재생
   - 재생 품질 선택 기능
   - 낮은 인프라 비용
   - 높은 가용성과 규모 확장성, 그리고 안정성
   - 지원 클라이언트: 모바일 앱, 웹 브라우저, 스마트 TV

## 개략적 규모 추정
 - 개략적 추정시 많은 것을 가정하게 된다. 가정한 사항에 대해선 면접관에게 알리고 동의를 구해야 한다.
   - 일간 능동 사용자 수는 500만
   - 한 사용자는 하루에 평균 5개의 비디오를 시청
   - 10%의 사용자가 하루에 1비디오 업로드
   - 비디오 평균 크기는 300MB
   - 비디오 저장을 위해 매일 새로 요구 되는 저장 용량
     - 500만 X 10% X 300MB = 150TB
   - CDN 비용
     - 클라우드 CDN을 통해 비디오를 서비스할 경우 CDN에 나가는 데이터 양에 따라 과금한다.
     - 아마존 클라우트프론트를 CDN 솔루션으로 사용할 경우 100% 트래픽이 미국에서 발생한다 가정하면 1GB당 $0.02의 요금이 발생한다. 문제를 단순화 하기 위해 비디오 스트리밍 비용만 따지도록하자.
     - 따라서 매일 발생하는 요금은 500만 X 5 비디오 X 0.3GB X $0.02 = $150,000이다.
![image_14-2.png](image%2Fimage_14-2.png)

 - 이 추정 결과에 따르면 CDN을 통해 비디오를 서비스하면 비용이 엄청나다. 클라우드 서비스 사업자가 큰 고객에게 비용을 할인 해주는 점을 감안하더라도 만만찮은 비용이다. 이 비용을 줄이는 방법에 대해서는 상세 설계를 진행하면서 자세히 알아보자.

## 계략적 설계안 제시 및 동의 구하기
 - 앞서 예로 들었던 대화에서 면접관은 기존 클라우드 서비스를 이용해도 좋다고 했다. 따라서 여기서 제시하는 CDN과 BLOB 스토리지의 경우 기존 클라우드 서비스를 활용할 것이다.
 - 왜 직접 만들지 않는가?는 질문엔 아래와 같다.
   - 시스템 설계 면접은 모든 것을 밑바닥부터 만드는 것과 관계는 없다. 주어진 시간 안에 적절한 기술을 골라 설계를 마치는 것이, 그 기술 각각이 어떻게 동작하는지 상세히 설명하는 것보다 중요하다.
   - 예시로 비디오를 저장하기 위해 BLOB 저장소를 쓸 것이라면 그 사실만 언급해도 충분하다. 이때 BLOB 저장소를 어떻게 구현할지 상세 설계를 제시하는 것은 지나치다.
   - 규모 확장이 쉬운 BLOB 저장소나 CDN을 만드는 것은 지극히 복잡하며 비용도 많이 드는 작업이다. 넷플릭스나 페이스북 같은 큰 회사도 모든것을 스스로 구축하지 않는다. 넷플릭스는 아마존의 클라우드 서비스를 페이스북은 마카마이 CDN을 이용한다.

![image_14-3.png](image%2Fimage_14-3.png)

 - 위 그림를 보면 시스템은 3개 컴포넌트로 구성된다.
   - 단말(client) : 컴퓨터, 모바일, 스마트 TV를 통해 유튜브를 시청할 수 있다.
   - CDN  : 비디오는 CDN에 저장한다. 재생 버튼을 누르면 CDN으로부터 스트리밍이 이루어진다.
   - API 서버 : 비디오 스트리밍을 제외한 모든 요청은 API 서버가 처리한다. 피드 추천, 비디오 업로드 URL 생성, 메타데이터 데이터베이스와 캐시 갱신, 사용자 가입 등등이 API 서버가 처리하는 작업이다.


---
 - 이 이후부터는 비디오 업로드 절차, 비디오 스트리밍 절차는 계략적 설계를 진행하게 될텐데 진영(설계 마스터)님이 해주실겁니다.
































